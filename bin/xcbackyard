#!/usr/bin/env ruby

require 'xcbackyard'

command = ARGV[0]

if command == "build"
    workspace_path = ARGV[1]
    xcodeproj_path = ARGV[2]
    
    if workspace_path.nil?
        workspace_path = File.join(Dir.pwd, Dir.glob("*.xcworkspace").first)
    end

    if xcodeproj_path.nil?
        xcodeproj_path = File.join(File.dirname(workspace_path), File.basename(workspace_path, ".*") + ".xcodeproj")
    end

    backyard = XCBackyard::BackyardBuilder.new(xcodeproj_path)
    backyard.add_backyard_to_workspace(workspace_path)

    system("open " + workspace_path)
elsif command == "clean"
    workspace_path = ARGV[1]
    xcodeproj_path = ARGV[2]
    
    if workspace_path.nil?
        workspace_path = File.join(Dir.pwd, Dir.glob("*.xcworkspace").first)
    end

    if xcodeproj_path.nil?
        xcodeproj_path = File.join(File.dirname(workspace_path), File.basename(workspace_path, ".*") + ".xcodeproj")
    end

    backyard = XCBackyard::BackyardBuilder.new(xcodeproj_path)
    backyard.remove_backyard_from_workspace(workspace_path)
else
    proj_file = ARGV[1]
    result_dir = File.join(ARGV[2], "TestDir")

    backyard = XCBackyard::BackyardBuilder.new(proj_file)

    workspace_path, result_proj_path = backyard.create_separate_workspace_with_backyard(result_dir)

    system("open " + workspace_path)
end


